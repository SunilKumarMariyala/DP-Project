# Continuous Data Flow from MATLAB to MySQL

This guide explains how to set up and use the continuous data flow feature that takes data generated by your MATLAB model, stores it in MySQL, and processes it with the Python prediction model in real-time.

## Overview

The system works as follows:

1. Your MATLAB model generates output files (CSV or MAT format)
2. The `matlab_continuous_demo.py` script monitors a directory for new files
3. When a new file is detected, it's processed and stored in the MySQL database
4. The prediction model analyzes the data and updates the database with fault predictions
5. The web interface displays the results in real-time

## Prerequisites

- MySQL database set up (see `README_MYSQL_SETUP.md`)
- MATLAB R2019b or newer with the required model
- Python 3.8+ with required packages (see `requirements.txt`)
- Environment variables configured (see below)

## Environment Variables

Set the following environment variables before running the system:

```bash
# Database Configuration
export DB_HOST=localhost
export DB_USER=solar_user
export DB_PASSWORD=your_secure_password
export DB_NAME=solar_panel_db

# MATLAB Configuration
export MATLAB_PATH="C:\Program Files\MATLAB\R2023b\bin\matlab.exe"
export MATLAB_MODEL_PATH="path\to\your\GridConnectedPVFarmExample"
export MATLAB_OUTPUT_DIR="path\to\output\directory"
```

For Windows PowerShell:
```powershell
# Database Configuration
$env:DB_HOST = "localhost"
$env:DB_USER = "solar_user"
$env:DB_PASSWORD = "your_secure_password"
$env:DB_NAME = "solar_panel_db"

# MATLAB Configuration
$env:MATLAB_PATH = "C:\Program Files\MATLAB\R2023b\bin\matlab.exe"
$env:MATLAB_MODEL_PATH = "path\to\your\GridConnectedPVFarmExample"
$env:MATLAB_OUTPUT_DIR = "path\to\output\directory"
```

## Running the Continuous Data Flow Demo

1. Start the file watcher:

```bash
python matlab_continuous_demo.py
```

By default, it will watch the directory specified in the `MATLAB_OUTPUT_DIR` environment variable. You can also specify a different directory:

```bash
python matlab_continuous_demo.py --watch-dir "C:\path\to\matlab\output"
```

2. Configure your MATLAB model to save output files to the watched directory.

3. Run your MATLAB model to generate data files.

4. The system will automatically:
   - Detect new files
   - Process the data
   - Store it in MySQL
   - Make predictions
   - Update the database with results

## MATLAB File Format Requirements

The system supports two file formats from MATLAB:

### CSV Format

CSV files should include at least the following columns:
- `pv_current` - Solar panel current
- `pv_voltage` - Solar panel voltage

Optional columns:
- `irradiance` - Solar irradiance (W/m²)
- `temperature` - Cell temperature (°C)
- `power` - Power output (W)

### MAT Format

MAT files should include at least the following variables:
- `pv_current` - Solar panel current
- `pv_voltage` - Solar panel voltage

Optional variables:
- `irradiance` - Solar irradiance (W/m²)
- `temperature` - Cell temperature (°C)
- `power` or `pv_power` - Power output (W)

## Monitoring the Results

You can monitor the results in several ways:

1. **Log Files**: Check `matlab_continuous_demo.log` for processing details

2. **Web Interface**: Run the web interface to see real-time updates:
   ```bash
   python solar_fault_detection.py
   ```

3. **Database Query**: Query the MySQL database directly:
   ```sql
   SELECT * FROM solar_panel_data ORDER BY timestamp DESC LIMIT 10;
   ```

## Troubleshooting

### No Files Being Detected

- Ensure the MATLAB model is saving files to the correct directory
- Check file permissions on the output directory
- Verify the file extensions are `.csv` or `.mat`

### Database Connection Issues

- Verify the database environment variables are set correctly
- Ensure MySQL is running and accessible
- Check the database user has proper permissions

### MATLAB Integration Issues

- Ensure MATLAB Engine for Python is installed
- Verify the MATLAB path environment variable is correct
- Check that the model path is accessible

## Example MATLAB Code

Here's an example of how to save data from your MATLAB model to a CSV file:

```matlab
% Generate or collect your data
time = (0:0.1:10)';
pv_voltage = 48 + 2*sin(time);
pv_current = 10 + 0.5*cos(time);
irradiance = 1000 * ones(size(time));
temperature = 25 * ones(size(time));
power = pv_voltage .* pv_current;

% Create a table
data = table(time, pv_voltage, pv_current, irradiance, temperature, power, ...
    'VariableNames', {'time', 'pv_voltage', 'pv_current', 'irradiance', 'temperature', 'power'});

% Save to CSV in the watched directory
output_dir = 'C:\path\to\watched\directory';
filename = fullfile(output_dir, ['solar_data_', datestr(now, 'yyyymmdd_HHMMSS'), '.csv']);
writetable(data, filename);
```

Or to save as a MAT file:

```matlab
% Generate or collect your data
time = (0:0.1:10)';
pv_voltage = 48 + 2*sin(time);
pv_current = 10 + 0.5*cos(time);
irradiance = 1000 * ones(size(time));
temperature = 25 * ones(size(time));
pv_power = pv_voltage .* pv_current;

% Save to MAT file in the watched directory
output_dir = 'C:\path\to\watched\directory';
filename = fullfile(output_dir, ['solar_data_', datestr(now, 'yyyymmdd_HHMMSS'), '.mat']);
save(filename, 'time', 'pv_voltage', 'pv_current', 'irradiance', 'temperature', 'pv_power');
```
